<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>영상 통화 테스트</title>
  </head>

  <body>
    <h2>Local Video</h2>
    <video id="localVideo" autoplay="autoplay" muted="muted"></video>
    <h2>Remote Video</h2>
    <video id="remoteVideo" autoplay="autoplay"></video>

    <button id="startButton">Start</button>
    <button id="callButton">Call</button>
    <button id="hangupButton">Hang Up</button>

    <script>
      // Assume we have already established a WebSocket connection as `socket`
      let localStream = null;
      let peerConnection = null;
      const configuration = {
        'iceServers': [
          {
            'urls': 'stun:stun.l.google.com:19302'
          }
        ]
      }; // Google's public STUN server

      document
        .getElementById('startButton')
        .onclick = async () => {
          localStream = await navigator
            .mediaDevices
            .getUserMedia({video: true, audio: true});
          document
            .getElementById('localVideo')
            .srcObject = localStream;
        };

      document
        .getElementById('callButton')
        .onclick = () => {
          peerConnection = new RTCPeerConnection(configuration);
          localStream
            .getTracks()
            .forEach(track => {
              peerConnection.addTrack(track, localStream);
            });

          // Assume we send signaling data via WebSocket and handle received data accordingly
          // This part needs to be implemented based on your signaling logic

          peerConnection.ontrack = event => {
            const [remoteStream] = event.streams;
            document
              .getElementById('remoteVideo')
              .srcObject = remoteStream;
          };
        };

      document
        .getElementById('hangupButton')
        .onclick = () => {
          peerConnection.close();
          peerConnection = null;
          // Send a message through WebSocket to notify the other peer (not shown)
        };
    </script>
  </body>

</html>